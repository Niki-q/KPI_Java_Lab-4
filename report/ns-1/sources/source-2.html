


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > DummyContainer</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/highlight-idea.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.fpm.di</a>
</div>

<h1>Coverage Summary for Class: DummyContainer (org.fpm.di)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">DummyContainer</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (9/9)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    93,3%
  </span>
  <span class="absValue">
    (70/75)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<div class="sourceCode" id="sourceCode"><i class="no-highlight">1</i>&nbsp;package org.fpm.di;
<i class="no-highlight">2</i>&nbsp;
<i class="no-highlight">3</i>&nbsp;import javax.inject.Singleton;
<i class="no-highlight">4</i>&nbsp;import javax.inject.Inject;
<i class="no-highlight">5</i>&nbsp;import java.lang.reflect.Constructor;
<i class="no-highlight">6</i>&nbsp;import java.lang.reflect.InvocationTargetException;
<i class="no-highlight">7</i>&nbsp;import java.util.*;
<i class="no-highlight">8</i>&nbsp;
<i class="no-highlight">9</i>&nbsp;public class DummyContainer implements Container {
<i class="no-highlight">10</i>&nbsp;    private Map&lt;Class, Class&gt; ClassList;
<i class="no-highlight">11</i>&nbsp;    private Map&lt;Class, Object&gt; InstanceList;
<i class="no-highlight">12</i>&nbsp;
<b class="fc"><i class="no-highlight">13</i>&nbsp;    DummyContainer() {</b>
<b class="fc"><i class="no-highlight">14</i>&nbsp;        this.InstanceList = new HashMap&lt;&gt;();</b>
<b class="fc"><i class="no-highlight">15</i>&nbsp;        this.ClassList = new HashMap&lt;&gt;();</b>
<b class="fc"><i class="no-highlight">16</i>&nbsp;    }</b>
<i class="no-highlight">17</i>&nbsp;
<i class="no-highlight">18</i>&nbsp;    &lt;T&gt; boolean isSingleton(Class&lt;T&gt; clazz) {
<b class="fc"><i class="no-highlight">19</i>&nbsp;        return clazz.isAnnotationPresent(Singleton.class);</b>
<b class="fc"><i class="no-highlight">20</i>&nbsp;    }</b>
<i class="no-highlight">21</i>&nbsp;
<i class="no-highlight">22</i>&nbsp;    &lt;T&gt; boolean isContainsClassList(Class&lt;T&gt; clazz) {
<b class="fc"><i class="no-highlight">23</i>&nbsp;        return ClassList.containsKey(clazz) || ClassList.containsValue(clazz);</b>
<b class="fc"><i class="no-highlight">24</i>&nbsp;    }</b>
<i class="no-highlight">25</i>&nbsp;
<i class="no-highlight">26</i>&nbsp;    &lt;T&gt; boolean isContainsInstanceList(Class&lt;T&gt; clazz) {
<b class="fc"><i class="no-highlight">27</i>&nbsp;        return InstanceList.containsKey(clazz);</b>
<b class="fc"><i class="no-highlight">28</i>&nbsp;    }</b>
<i class="no-highlight">29</i>&nbsp;
<i class="no-highlight">30</i>&nbsp;    &lt;T&gt; boolean isClassConstructorHaveAnnotationInject(Class&lt;T&gt; clazz) {
<b class="fc"><i class="no-highlight">31</i>&nbsp;        Constructor&lt;?&gt;[] constructors = clazz.getDeclaredConstructors();</b>
<b class="fc"><i class="no-highlight">32</i>&nbsp;        for (Constructor&lt;?&gt; constructor : constructors) {</b>
<b class="fc"><i class="no-highlight">33</i>&nbsp;            if (constructor.isAnnotationPresent(Inject.class))</b>
<b class="fc"><i class="no-highlight">34</i>&nbsp;                return true;</b>
<b class="fc"><i class="no-highlight">35</i>&nbsp;        }</b>
<b class="fc"><i class="no-highlight">36</i>&nbsp;        return false;</b>
<b class="fc"><i class="no-highlight">37</i>&nbsp;    }</b>
<i class="no-highlight">38</i>&nbsp;
<i class="no-highlight">39</i>&nbsp;    &lt;T&gt; List&lt;Constructor&lt;?&gt;&gt; getConstructorsInject(Class&lt;T&gt; clazz) {
<b class="fc"><i class="no-highlight">40</i>&nbsp;        List&lt;Constructor&lt;?&gt;&gt; list = new LinkedList&lt;&gt;();</b>
<b class="fc"><i class="no-highlight">41</i>&nbsp;        Constructor&lt;?&gt;[] constructors = clazz.getDeclaredConstructors();</b>
<b class="fc"><i class="no-highlight">42</i>&nbsp;        for (Constructor&lt;?&gt; constructor : constructors) {</b>
<b class="fc"><i class="no-highlight">43</i>&nbsp;            if (constructor.isAnnotationPresent(Inject.class)){</b>
<b class="fc"><i class="no-highlight">44</i>&nbsp;                constructor.setAccessible(true);</b>
<b class="fc"><i class="no-highlight">45</i>&nbsp;                list.add(constructor);</b>
<b class="fc"><i class="no-highlight">46</i>&nbsp;            }</b>
<i class="no-highlight">47</i>&nbsp;        }
<b class="fc"><i class="no-highlight">48</i>&nbsp;        if (list.size() &gt; 1)</b>
<b class="fc"><i class="no-highlight">49</i>&nbsp;            list = sortListOfConstructors(list);</b>
<b class="fc"><i class="no-highlight">50</i>&nbsp;        return list;</b>
<b class="fc"><i class="no-highlight">51</i>&nbsp;    }</b>
<i class="no-highlight">52</i>&nbsp;
<i class="no-highlight">53</i>&nbsp;    &lt;T&gt; List&lt;Constructor&lt;?&gt;&gt; sortListOfConstructors(List&lt;Constructor&lt;?&gt;&gt; list) {
<b class="fc"><i class="no-highlight">54</i>&nbsp;        boolean isSorted = false;</b>
<b class="fc"><i class="no-highlight">55</i>&nbsp;        while (!isSorted) {</b>
<b class="fc"><i class="no-highlight">56</i>&nbsp;            isSorted = true;</b>
<b class="fc"><i class="no-highlight">57</i>&nbsp;            for (int i = 0; i &lt;= list.size() - 2; i++) {</b>
<b class="fc"><i class="no-highlight">58</i>&nbsp;                if (list.get(i).getParameterCount() &lt; list.get(i + 1).getParameterCount()) {</b>
<b class="fc"><i class="no-highlight">59</i>&nbsp;                    isSorted = false;</b>
<b class="fc"><i class="no-highlight">60</i>&nbsp;                    Constructor&lt;?&gt; buff = list.get(i);</b>
<b class="fc"><i class="no-highlight">61</i>&nbsp;                    list.set(i, list.get(i + 1));</b>
<b class="fc"><i class="no-highlight">62</i>&nbsp;                    list.set(i + 1, buff);</b>
<b class="nc"><i class="no-highlight">63</i>&nbsp;                }</b>
<i class="no-highlight">64</i>&nbsp;            }
<i class="no-highlight">65</i>&nbsp;        }
<b class="fc"><i class="no-highlight">66</i>&nbsp;        return list;</b>
<b class="nc"><i class="no-highlight">67</i>&nbsp;    }</b>
<i class="no-highlight">68</i>&nbsp;
<i class="no-highlight">69</i>&nbsp;    &lt;T&gt; T getInstanceOfInjectConstructor(Class&lt;T&gt; ourclazz) throws InstantiationException {
<b class="fc"><i class="no-highlight">70</i>&nbsp;        List&lt;T&gt; instances = new LinkedList&lt;&gt;();</b>
<b class="fc"><i class="no-highlight">71</i>&nbsp;        for (Constructor&lt;?&gt; constructor : getConstructorsInject(ourclazz)){</b>
<b class="fc"><i class="no-highlight">72</i>&nbsp;            List&lt;Object&gt; arguments = new ArrayList&lt;&gt;();</b>
<b class="fc"><i class="no-highlight">73</i>&nbsp;            try {</b>
<b class="fc"><i class="no-highlight">74</i>&nbsp;                for (int i = 0; i &lt;= constructor.getParameterCount() - 1; i++) {</b>
<b class="fc"><i class="no-highlight">75</i>&nbsp;                    arguments.add(this.getComponent(constructor.getParameterTypes()[i]));</b>
<i class="no-highlight">76</i>&nbsp;                }
<b class="fc"><i class="no-highlight">77</i>&nbsp;                T instance = ourclazz.cast(</b>
<b class="fc"><i class="no-highlight">78</i>&nbsp;                        constructor.newInstance(arguments.toArray())</b>
<b class="fc"><i class="no-highlight">79</i>&nbsp;                );</b>
<b class="fc"><i class="no-highlight">80</i>&nbsp;                instances.add(instance);</b>
<b class="fc"><i class="no-highlight">81</i>&nbsp;            }catch (InvocationTargetException | InstantiationException | IllegalAccessException | IllegalArgumentException ignored){}</b>
<b class="fc"><i class="no-highlight">82</i>&nbsp;        }</b>
<b class="fc"><i class="no-highlight">83</i>&nbsp;        if (instances.isEmpty())</b>
<b class="fc"><i class="no-highlight">84</i>&nbsp;            throw new InstantiationException(&quot;The @Inject annotation was specified in the annotation of the class constructors, but none of the constructors with this annotation contains the objects specified in the container configuration in ALL of its arguments&quot;);</b>
<b class="fc"><i class="no-highlight">85</i>&nbsp;        return instances.get(0);</b>
<b class="fc"><i class="no-highlight">86</i>&nbsp;    }</b>
<i class="no-highlight">87</i>&nbsp;
<i class="no-highlight">88</i>&nbsp;    @Override
<i class="no-highlight">89</i>&nbsp;    synchronized public &lt;T&gt; T getComponent(Class&lt;T&gt; clazz) {
<b class="fc"><i class="no-highlight">90</i>&nbsp;        if (isContainsClassList(clazz)) {</b>
<b class="fc"><i class="no-highlight">91</i>&nbsp;            Class&lt;T&gt; ourclazz = ClassList.get(clazz);</b>
<b class="fc"><i class="no-highlight">92</i>&nbsp;            if (isContainsInstanceList(ourclazz))</b>
<b class="fc"><i class="no-highlight">93</i>&nbsp;                return (T) InstanceList.get(ourclazz);</b>
<b class="fc"><i class="no-highlight">94</i>&nbsp;            try {</b>
<b class="fc"><i class="no-highlight">95</i>&nbsp;                if (isSingleton(ourclazz)) {</b>
<b class="fc"><i class="no-highlight">96</i>&nbsp;                    T instance = ourclazz.cast(ourclazz.getDeclaredConstructor().newInstance());</b>
<b class="fc"><i class="no-highlight">97</i>&nbsp;                    InstanceList.put(ourclazz, instance);</b>
<b class="fc"><i class="no-highlight">98</i>&nbsp;                    return instance;</b>
<b class="fc"><i class="no-highlight">99</i>&nbsp;                }</b>
<b class="fc"><i class="no-highlight">100</i>&nbsp;                if (isClassConstructorHaveAnnotationInject(ourclazz)) {</b>
<b class="fc"><i class="no-highlight">101</i>&nbsp;                    return getInstanceOfInjectConstructor(ourclazz);</b>
<b class="fc"><i class="no-highlight">102</i>&nbsp;                }</b>
<b class="fc"><i class="no-highlight">103</i>&nbsp;                return ourclazz.cast(ourclazz.getDeclaredConstructor().newInstance());</b>
<b class="fc"><i class="no-highlight">104</i>&nbsp;            } catch (IllegalAccessException | InstantiationException | InvocationTargetException | NoSuchMethodException e) {</b>
<b class="nc"><i class="no-highlight">105</i>&nbsp;                e.printStackTrace();</b>
<b class="nc"><i class="no-highlight">106</i>&nbsp;            }</b>
<i class="no-highlight">107</i>&nbsp;        }
<b class="fc"><i class="no-highlight">108</i>&nbsp;        throw new IllegalArgumentException(&quot;A class value was entered that was not specified in the configuration&quot;);</b>
<b class="nc"><i class="no-highlight">109</i>&nbsp;    }</b>
<i class="no-highlight">110</i>&nbsp;
<i class="no-highlight">111</i>&nbsp;}
<i class="no-highlight">112</i>&nbsp;
</div>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
        var codeBlock = document.getElementById('sourceCode');

        if (codeBlock) {
            hljs.highlightBlock(codeBlock);
        }
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2021-12-06 16:46</div>
</div>
</body>
</html>
