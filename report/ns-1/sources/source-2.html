


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > DummyContainer</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/highlight-idea.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.fpm.di</a>
</div>

<h1>Coverage Summary for Class: DummyContainer (org.fpm.di)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">DummyContainer</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (10/10)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    92,6%
  </span>
  <span class="absValue">
    (50/54)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<div class="sourceCode" id="sourceCode"><i class="no-highlight">1</i>&nbsp;package org.fpm.di;
<i class="no-highlight">2</i>&nbsp;
<i class="no-highlight">3</i>&nbsp;import javax.inject.Singleton;
<i class="no-highlight">4</i>&nbsp;import javax.inject.Inject;
<i class="no-highlight">5</i>&nbsp;import java.lang.reflect.Constructor;
<i class="no-highlight">6</i>&nbsp;import java.lang.reflect.InvocationTargetException;
<i class="no-highlight">7</i>&nbsp;import java.util.*;
<i class="no-highlight">8</i>&nbsp;
<i class="no-highlight">9</i>&nbsp;public class DummyContainer implements Container {
<i class="no-highlight">10</i>&nbsp;    private final Map&lt;Class, Class&gt; ClassList;
<i class="no-highlight">11</i>&nbsp;    private final Map&lt;Class, Object&gt; InstanceList;
<i class="no-highlight">12</i>&nbsp;
<i class="no-highlight">13</i>&nbsp;    Map&lt;Class, Class&gt; getClassList(){
<b class="fc"><i class="no-highlight">14</i>&nbsp;        return this.ClassList;</b>
<i class="no-highlight">15</i>&nbsp;    }
<i class="no-highlight">16</i>&nbsp;    Map&lt;Class, Object&gt; getInstanceList(){
<b class="fc"><i class="no-highlight">17</i>&nbsp;        return this.InstanceList;</b>
<i class="no-highlight">18</i>&nbsp;    }
<i class="no-highlight">19</i>&nbsp;
<b class="fc"><i class="no-highlight">20</i>&nbsp;    DummyContainer() {</b>
<b class="fc"><i class="no-highlight">21</i>&nbsp;        this.InstanceList = new HashMap&lt;&gt;();</b>
<b class="fc"><i class="no-highlight">22</i>&nbsp;        this.ClassList = new HashMap&lt;&gt;();</b>
<i class="no-highlight">23</i>&nbsp;    }
<i class="no-highlight">24</i>&nbsp;
<i class="no-highlight">25</i>&nbsp;    &lt;T&gt; boolean isSingleton(Class&lt;T&gt; clazz) {
<b class="fc"><i class="no-highlight">26</i>&nbsp;        return clazz.isAnnotationPresent(Singleton.class);</b>
<i class="no-highlight">27</i>&nbsp;    }
<i class="no-highlight">28</i>&nbsp;
<i class="no-highlight">29</i>&nbsp;    &lt;T&gt; boolean isContainsClassList(Class&lt;T&gt; clazz) {
<b class="fc"><i class="no-highlight">30</i>&nbsp;        return ClassList.containsKey(clazz) || ClassList.containsValue(clazz);</b>
<i class="no-highlight">31</i>&nbsp;    }
<i class="no-highlight">32</i>&nbsp;
<i class="no-highlight">33</i>&nbsp;    &lt;T&gt; boolean isContainsInstanceList(Class&lt;T&gt; clazz) {
<b class="fc"><i class="no-highlight">34</i>&nbsp;        synchronized (InstanceList) {</b>
<b class="fc"><i class="no-highlight">35</i>&nbsp;            return InstanceList.containsKey(clazz);</b>
<b class="nc"><i class="no-highlight">36</i>&nbsp;        }</b>
<i class="no-highlight">37</i>&nbsp;    }
<i class="no-highlight">38</i>&nbsp;
<i class="no-highlight">39</i>&nbsp;    &lt;T&gt; boolean isClassConstructorHaveAnnotationInject(Class&lt;T&gt; clazz) {
<b class="fc"><i class="no-highlight">40</i>&nbsp;        Constructor&lt;?&gt;[] constructors = clazz.getDeclaredConstructors();</b>
<b class="fc"><i class="no-highlight">41</i>&nbsp;        for (Constructor&lt;?&gt; constructor : constructors) {</b>
<b class="fc"><i class="no-highlight">42</i>&nbsp;            if (constructor.isAnnotationPresent(Inject.class))</b>
<b class="fc"><i class="no-highlight">43</i>&nbsp;                return true;</b>
<i class="no-highlight">44</i>&nbsp;        }
<b class="fc"><i class="no-highlight">45</i>&nbsp;        return false;</b>
<i class="no-highlight">46</i>&nbsp;    }
<i class="no-highlight">47</i>&nbsp;
<i class="no-highlight">48</i>&nbsp;    &lt;T&gt; List&lt;Constructor&lt;?&gt;&gt; getConstructorsInject(Class&lt;T&gt; clazz) {
<b class="fc"><i class="no-highlight">49</i>&nbsp;        List&lt;Constructor&lt;?&gt;&gt; list = new ArrayList&lt;&gt;();</b>
<b class="fc"><i class="no-highlight">50</i>&nbsp;        Constructor&lt;?&gt;[] constructors = clazz.getDeclaredConstructors();</b>
<b class="fc"><i class="no-highlight">51</i>&nbsp;        for (Constructor&lt;?&gt; constructor : constructors) {</b>
<b class="fc"><i class="no-highlight">52</i>&nbsp;            if (constructor.isAnnotationPresent(Inject.class)){</b>
<b class="fc"><i class="no-highlight">53</i>&nbsp;                constructor.setAccessible(true);</b>
<b class="fc"><i class="no-highlight">54</i>&nbsp;                list.add(constructor);</b>
<i class="no-highlight">55</i>&nbsp;            }
<i class="no-highlight">56</i>&nbsp;        }
<b class="fc"><i class="no-highlight">57</i>&nbsp;        if (list.size() &gt; 1) {</b>
<b class="fc"><i class="no-highlight">58</i>&nbsp;            list.sort(Comparator.comparingInt(Constructor::getParameterCount));</b>
<b class="fc"><i class="no-highlight">59</i>&nbsp;            Collections.reverse(list);</b>
<i class="no-highlight">60</i>&nbsp;        }
<b class="fc"><i class="no-highlight">61</i>&nbsp;        return list;</b>
<i class="no-highlight">62</i>&nbsp;    }
<i class="no-highlight">63</i>&nbsp;    &lt;T&gt; T getInstanceOfInjectConstructor(Class&lt;T&gt; ourclazz){
<b class="fc"><i class="no-highlight">64</i>&nbsp;        List&lt;T&gt; instances = new LinkedList&lt;&gt;();</b>
<b class="fc"><i class="no-highlight">65</i>&nbsp;        for (Constructor&lt;?&gt; constructor : getConstructorsInject(ourclazz)){</b>
<b class="fc"><i class="no-highlight">66</i>&nbsp;            List&lt;Object&gt; arguments = new ArrayList&lt;&gt;();</b>
<i class="no-highlight">67</i>&nbsp;            try {
<b class="fc"><i class="no-highlight">68</i>&nbsp;                for (int i = 0; i &lt;= constructor.getParameterCount() - 1; i++) {</b>
<b class="fc"><i class="no-highlight">69</i>&nbsp;                    arguments.add(this.getComponent(constructor.getParameterTypes()[i]));</b>
<i class="no-highlight">70</i>&nbsp;                }
<b class="fc"><i class="no-highlight">71</i>&nbsp;                T instance = ourclazz.cast(</b>
<b class="fc"><i class="no-highlight">72</i>&nbsp;                        constructor.newInstance(arguments.toArray())</b>
<i class="no-highlight">73</i>&nbsp;                );
<b class="fc"><i class="no-highlight">74</i>&nbsp;                instances.add(instance);</b>
<b class="fc"><i class="no-highlight">75</i>&nbsp;            }catch (InvocationTargetException | InstantiationException | IllegalAccessException | IllegalArgumentException ignored){}</b>
<b class="fc"><i class="no-highlight">76</i>&nbsp;        }</b>
<b class="fc"><i class="no-highlight">77</i>&nbsp;        if (instances.isEmpty()) {</b>
<b class="fc"><i class="no-highlight">78</i>&nbsp;            throw new RuntimeException(&quot;The @Inject annotation was specified in the annotation of the class constructors, but none of the constructors with this annotation contains the objects specified in the container configuration in ALL of its arguments&quot;);</b>
<i class="no-highlight">79</i>&nbsp;        }
<b class="fc"><i class="no-highlight">80</i>&nbsp;        return instances.get(0);</b>
<i class="no-highlight">81</i>&nbsp;    }
<i class="no-highlight">82</i>&nbsp;
<i class="no-highlight">83</i>&nbsp;    @Override
<i class="no-highlight">84</i>&nbsp;    public &lt;T&gt; T getComponent(Class&lt;T&gt; clazz) {
<b class="fc"><i class="no-highlight">85</i>&nbsp;        if (isContainsClassList(clazz)) {</b>
<b class="fc"><i class="no-highlight">86</i>&nbsp;            Class&lt;T&gt; ourclazz = ClassList.get(clazz);</b>
<b class="fc"><i class="no-highlight">87</i>&nbsp;            synchronized (InstanceList){</b>
<b class="fc"><i class="no-highlight">88</i>&nbsp;                if (isContainsInstanceList(ourclazz))</b>
<b class="fc"><i class="no-highlight">89</i>&nbsp;                    return (T) InstanceList.get(ourclazz);</b>
<i class="no-highlight">90</i>&nbsp;                try {
<b class="fc"><i class="no-highlight">91</i>&nbsp;                    if (isSingleton(ourclazz)) {</b>
<b class="fc"><i class="no-highlight">92</i>&nbsp;                        T instance = ourclazz.cast(ourclazz.getDeclaredConstructor().newInstance());</b>
<b class="fc"><i class="no-highlight">93</i>&nbsp;                        InstanceList.put(ourclazz, instance);</b>
<b class="fc"><i class="no-highlight">94</i>&nbsp;                        return instance;</b>
<i class="no-highlight">95</i>&nbsp;                    }
<b class="fc"><i class="no-highlight">96</i>&nbsp;                    if (isClassConstructorHaveAnnotationInject(ourclazz)) {</b>
<b class="fc"><i class="no-highlight">97</i>&nbsp;                        return getInstanceOfInjectConstructor(ourclazz);</b>
<i class="no-highlight">98</i>&nbsp;                    }
<b class="fc"><i class="no-highlight">99</i>&nbsp;                    return ourclazz.cast(ourclazz.getDeclaredConstructor().newInstance());</b>
<b class="nc"><i class="no-highlight">100</i>&nbsp;                } catch (IllegalAccessException | InstantiationException | InvocationTargetException | NoSuchMethodException e) {</b>
<b class="nc"><i class="no-highlight">101</i>&nbsp;                    e.printStackTrace();</b>
<i class="no-highlight">102</i>&nbsp;                }
<b class="nc"><i class="no-highlight">103</i>&nbsp;            }</b>
<i class="no-highlight">104</i>&nbsp;        }
<b class="fc"><i class="no-highlight">105</i>&nbsp;        throw new IllegalArgumentException(&quot;A class value was entered that was not specified in the configuration&quot;);</b>
<i class="no-highlight">106</i>&nbsp;    }
<i class="no-highlight">107</i>&nbsp;}
<i class="no-highlight">108</i>&nbsp;
</div>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
        var codeBlock = document.getElementById('sourceCode');

        if (codeBlock) {
            hljs.highlightBlock(codeBlock);
        }
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2021-12-17 08:22</div>
</div>
</body>
</html>
